-- Create the advertisement table
CREATE TABLE IF NOT EXISTS advertisement (
    id SERIAL NOT NULL,
    title VARCHAR(255) NOT NULL,
    start_at TIMESTAMP NOT NULL,
    end_at TIMESTAMP NOT NULL,
    conditions JSONB,
    PRIMARY KEY (id, end_at)
) PARTITION BY RANGE (end_at);

-- Create the partitions based on ranges of end_at
CREATE TABLE IF NOT EXISTS advertisement_January PARTITION OF advertisement FOR VALUES FROM ('2024-01-01T00:00:00Z') TO ('2024-01-31T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_February PARTITION OF advertisement FOR VALUES FROM ('2024-02-01T00:00:00Z') TO ('2024-02-29T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_March PARTITION OF advertisement FOR VALUES FROM ('2024-03-01T00:00:00Z') TO ('2024-03-31T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_April PARTITION OF advertisement FOR VALUES FROM ('2024-04-01T00:00:00Z') TO ('2024-04-30T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_May PARTITION OF advertisement FOR VALUES FROM ('2024-05-01T00:00:00Z') TO ('2024-05-31T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_June PARTITION OF advertisement FOR VALUES FROM ('2024-06-01T00:00:00Z') TO ('2024-06-30T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_July PARTITION OF advertisement FOR VALUES FROM ('2024-07-01T00:00:00Z') TO ('2024-07-31T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_August PARTITION OF advertisement FOR VALUES FROM ('2024-08-01T00:00:00Z') TO ('2024-08-31T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_September PARTITION OF advertisement FOR VALUES FROM ('2024-09-01T00:00:00Z') TO ('2024-09-30T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_October PARTITION OF advertisement FOR VALUES FROM ('2024-10-01T00:00:00Z') TO ('2024-10-31T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_November PARTITION OF advertisement FOR VALUES FROM ('2024-11-01T00:00:00Z') TO ('2024-11-30T23:59:59Z');
CREATE TABLE IF NOT EXISTS advertisement_December PARTITION OF advertisement FOR VALUES FROM ('2024-12-01T00:00:00Z') TO ('2024-12-31T23:59:59Z');


CREATE INDEX ON advertisement (end_at);

-- 可以增加 sub-partitioning for start_at
